# ADR-004: Audio Recording Format — OGG Opus

Status: Accepted
Date: 2026-02-19
Deciders: @owner

## Context

Необходимо выбрать формат хранения аудиозаписей птиц на устройстве. Ключевые факторы: качество для ML-распознавания, размер файла, энергоэффективность кодирования, совместимость.

Параметры записи: 44.1 kHz, моно, максимальная длительность 60 секунд.

## Decision

**Формат:** OGG Opus

- Контейнер: OGG
- Кодек: Opus
- Частота дискретизации: 44.1 kHz (или 48 kHz — нативная для Opus)
- Каналы: моно
- Битрейт: 64-96 kbps (достаточно для голосов птиц)

## Consequences

### Positive
- Лучшее качество при меньшем размере по сравнению с MP3 (Opus превосходит MP3 на любом битрейте)
- ~0.5-0.7 MB за минуту (vs ~1 MB для MP3 128kbps) — экономия места на устройстве
- Нативная поддержка в Android (MediaRecorder поддерживает Opus с API 29+)
- Open source кодек, без лицензионных отчислений
- Низкая задержка кодирования — важно для реалтайм-записи

### Negative
- Менее распространён чем MP3 — некоторые десктопные плееры могут не открыть
- При экспорте данных может потребоваться конвертация в MP3 для совместимости
- BirdNET принимает WAV на вход — потребуется декодирование перед ML inference

### Neutral
- Для ML inference аудио всё равно декодируется в PCM (raw samples) — формат хранения не влияет на точность распознавания
- 48 kHz — нативная частота Opus, может быть предпочтительнее 44.1 kHz

## Alternatives Considered

- **MP3 128kbps** — универсальная совместимость, но худшее соотношение качество/размер. Лицензия: патенты истекли, свободен
- **WAV (lossless)** — максимальное качество, но ~5 MB/мин. Быстро заполнит память устройства
- **AAC** — хорошее качество, нативная поддержка. Но Opus превосходит на низких битрейтах, а AAC имеет лицензионные нюансы
