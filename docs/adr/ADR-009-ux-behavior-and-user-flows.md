# ADR-009: UX Behavior and User Flows

Status: Accepted (updated 2026-02-19)
Date: 2026-02-19
Deciders: @owner

## Context

Необходимо определить ключевые UX-решения: навигация, обработка GPS, порог confidence, управление хранилищем.

Основной экран — Live Detection (см. ADR-010).

## Decision

### 1. Навигация: Bottom Navigation Bar

3 таба: **Определение** | **История** | **Настройки**

- **Определение** — экран Live Detection (Start/Pause/Stop/Reset + лента обнаружений)
- **История** — все сохранённые наблюдения
- **Настройки** — язык, тема, разрешения

Detail Screen (карточка вида) — push поверх любого таба (из Live Detection или из Истории).

### 2. GPS: опционально

- Запрашиваем разрешение на локацию при первом запуске
- Если разрешение дано — сохраняем координаты с каждым наблюдением
- Если отказано или GPS недоступен — lat/lng = null, запись работает нормально
- Ненавязчивая подсказка в настройках о пользе GPS для данных

### 3. Порог confidence: ≥ 80%

- Ниже 80% — chunk отбрасывается, в ленту Live Detection не попадает
- Порог захардкожен (не в настройках пользователя на MVP)
- В будущем: настраиваемый порог

### 4. Управление хранилищем: автоудаление

- Лимит: 10 000 записей на устройстве
- При достижении лимита — автоматическое удаление самых старых наблюдений (аудио + метаданные)
- Проверка свободного места перед записью: если < 100 MB — предупреждение + автоудаление старых
- Удаление пакетами по 100 записей за раз (чтобы не тормозить UI)

### 5. Воспроизведение аудио

- Тап на карточку в Live Detection или Истории → Detail Screen → кнопка Play
- При нажатии Play в Live Detection — анализ автоматически ставится на Pause
- При возврате из Detail Screen — анализ остаётся на паузе (пользователь сам нажимает Resume)

### 6. Экраны приложения (полный список)

| Экран | Тип | Описание |
|-------|-----|----------|
| Live Detection | Tab (Bottom Nav) | Непрерывный анализ + лента обнаружений |
| History | Tab (Bottom Nav) | Сохранённые наблюдения |
| Settings | Tab (Bottom Nav) | Язык, тема, разрешения |
| Detail | Push screen | Детали вида + плеер аудиофрагмента |

## Consequences

### Positive
- Bottom Bar — стандартный паттерн, быстрый доступ к любому разделу
- Строгий порог 80% — только качественные данные
- Автоудаление — пользователь не менеджит хранилище
- Автопауза при воспроизведении — микрофон не пишет звук плеера

### Negative
- Порог 80% отсеет часть корректных результатов при шуме
- Автоудаление может удалить ценные старые записи без предупреждения

### Neutral
- Порог и автоудаление можно сделать настраиваемыми в будущем
- Detail Screen расширяется справочником без изменения навигации
