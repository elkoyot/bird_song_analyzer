# Документ требований к разработке приложения
## Bird Song Analyzer

**Дата создания:** 2026-02-17
**Версия документа:** 1.0
**Статус:** Утверждено

---

## 1. Общая информация о проекте

### 1.1 Название проекта
**Bird Song Analyzer** - Мобильное приложение для определения птиц по голосу и сбора данных о наблюдениях

### 1.2 Описание проекта
Приложение предназначено для автоматического определения видов птиц на основе анализа их голосов с использованием технологий машинного обучения. Приложение также позволяет собирать и систематизировать данные о наблюдениях для дальнейшего использования в исследованиях и личных целях.

### 1.3 Команда разработки
- **Размер команды:** 1 разработчик (solo-разработка)
- **Роли:** Full-stack mobile developer (Android + Backend + ML integration)

---

## 2. Цели и задачи

### 2.1 Основные цели
1. **Определение птиц по голосу** - автоматическое распознавание видов птиц на основе их пения и звуков
2. **Сбор данных** - систематизация информации о наблюдениях для определенных видов птиц
3. **Образовательная функция** - предоставление справочной информации о видах птиц

### 2.2 Бизнес-задачи
- Создание удобного инструмента для любителей природы и орнитологов
- Сбор данных для потенциальных научных исследований
- Популяризация наблюдения за птицами

### 2.3 Ключевые метрики успеха
- Точность распознавания: 80-90%
- Время отклика на распознавание: < 3 секунд
- Автономная работа в офлайн-режиме для базовых функций
- Минимальное потребление батареи в режиме аудио-ловушки

---

## 3. Целевая аудитория

### 3.1 Основные группы пользователей
- **Любители природы** - люди, интересующиеся птицами и природой
- **Орнитологи-любители** - активные наблюдатели за птицами
- **Исследователи** - люди, собирающие данные для научных целей
- **Образовательный сегмент** - студенты биологических специальностей

### 3.2 География
- **Регион:** Вся Европа (европейские виды птиц)
- **Языки:** Русский, Английский (первый релиз)

---

## 4. Функциональные требования

### 4.1 Основной функционал (MVP - Расширенный)

#### 4.1.1 Запись и распознавание
- **FR-001:** Запись аудио с микрофона устройства
- **FR-002:** Локальное распознавание вида птицы с использованием ML-модели на устройстве
- **FR-003:** Отображение результата распознавания (только лучший результат, без списка вероятностей)
- **FR-004:** Автоматическое сохранение записи с результатом

#### 4.1.2 Режим непрерывного определения
- **FR-005:** Фоновая работа приложения при непрерывном определении
- **FR-006:** Возможность включения/отключения непрерывного режима
- **FR-007:** Уведомления при обнаружении новых видов
- **FR-008:** Запись активна даже при свернутом приложении

#### 4.1.3 Режим аудио-ловушки (базовый)
- **FR-009:** Настройка времени работы аудио-ловушки
- **FR-010:** Минимизация энергопотребления для максимальной автономности
- **FR-011:** Автоматическая активация/деактивация по таймеру
- **FR-012:** Снижение нагрузки на процессор в режиме ловушки

#### 4.1.4 Умная аудио-ловушка (Smart Audio Trap)
**КЛЮЧЕВОЕ КОНКУРЕНТНОЕ ПРЕИМУЩЕСТВО**

- **FR-013:** Активация записи по голосу (Voice Activity Detection)
  - Постоянный мониторинг микрофона в низкоэнергетическом режиме
  - Запись начинается только при обнаружении звукового сигнала
  - Буферизация последних 3-5 секунд перед триггером
  - Автоматическая остановка при тишине

- **FR-014:** Интеллектуальные фильтры записи
  - "Записывать все виды" - сохранять все обнаруженные птицы
  - "Только новые для меня виды" - пропускать уже записанные виды
  - "Только редкие виды" - запись только из предустановленного списка
  - "Целевой список" - пользователь выбирает интересующие виды

- **FR-015:** Настройки чувствительности триггера
  - Регулируемый порог срабатывания (dB уровень)
  - Минимальная длительность сигнала (1-5 секунд)
  - Игнорирование фонового шума (ветер, дождь, трафик)

- **FR-016:** Предварительная классификация в реальном времени
  - Быстрая классификация на TFLite при обнаружении звука
  - Применение фильтров до сохранения (экономия места)
  - Решение: сохранить или отбросить запись

- **FR-017:** Автоматическая очистка
  - Удаление записей без птиц (только шум/помехи)
  - Удаление дубликатов (та же птица, то же место, интервал < 5 мин)
  - Настройка: сохранять локально или только отправлять на сервер

- **FR-018:** Уведомления в режиме умной ловушки
  - Push-уведомление: "Обнаружен новый вид: [Название]"
  - Накопительные уведомления: "Обнаружено 5 новых видов"
  - Настройка частоты уведомлений (каждое / раз в час / отключить)
  - Звуковые/вибро уведомления (опционально)

- **FR-019:** Статистика умной ловушки
  - Счетчик: обнаружено сигналов / сохранено / отфильтровано
  - Эффективность: "Сэкономлено 85% места благодаря фильтрам"
  - Лог активности: когда какие виды обнаружены

**Техническая реализация:**
- VAD (Voice Activity Detection) алгоритм
- Circular buffer для предзаписи
- Энергоэффективный мониторинг (минимум CPU)
- Приоритет: качество данных > количество данных

**Преимущества:**
- Минимальный размер данных (нет пустых записей)
- Экономия батареи (не пишет тишину)
- Целевой мониторинг (только нужные виды)
- Автоматизация (меньше ручной работы пользователя)

#### 4.1.5 Сбор и хранение данных
- **FR-020:** Автоматическое сохранение следующих данных при каждом определении:
  - Геолокация (GPS координаты, если доступна)
  - Время и дата наблюдения
  - Определенный вид птицы
  - Аудиозапись в формате MP3
- **FR-021:** Локальное хранение данных в SQLite базе (временное, до синхронизации)
- **FR-022:** Синхронизация данных с сервером при наличии интернета
- **FR-023:** Работа в офлайн-режиме с последующей синхронизацией

#### 4.1.6 История наблюдений
- **FR-024:** Просмотр списка всех наблюдений
- **FR-025:** Фильтрация по видам, датам, локации
- **FR-026:** Возможность прослушивания сохраненных записей
- **FR-027:** Удаление записей из истории (локально и на сервере)

#### 4.1.7 Авторизация (опциональная)
- **FR-028:** Возможность использования без регистрации (анонимные данные)
- **FR-029:** Регистрация через email
- **FR-030:** Вход в существующий аккаунт
- **FR-031:** Синхронизация данных между устройствами для зарегистрированных пользователей

### 4.2 Дополнительный функционал (Post-MVP)

**Приоритизация:** Релизы 2, 3, 4+ в порядке приоритета

---

#### 4.2.1 Релиз 2: Коллаборация и геймификация (2-3 месяца после MVP)

##### Режим "Экспедиция"
**ВЫСОКИЙ ПРИОРИТЕТ - Уникальная функция**

- **FR-032:** Создание экспедиции с уникальным кодом
- **FR-033:** Присоединение к экспедиции по коду
- **FR-034:** Синхронизация данных всех участников в реальном времени
- **FR-035:** Общая карта с местоположением участников (опционально)
- **FR-036:** Агрегированная статистика экспедиции:
  - Общее количество обнаруженных видов
  - Вклад каждого участника
  - Временная шкала активности
- **FR-037:** Экспорт объединенного датасета экспедиции
- **FR-038:** Управление участниками (владелец экспедиции)

**Примечание:** Вся логика на сервере, мобильное приложение - только UI

##### Геймификация
**ВЫСОКИЙ ПРИОРИТЕТ - Мотивация пользователей**

- **FR-039:** Система достижений (бейджи):
  - "Первооткрыватель" - первый новый вид для себя
  - "Коллекционер" - 10, 50, 100, 500 видов
  - "Редкий экземпляр" - запись редкого вида
  - "Золотой микрофон" - 10 записей высокого качества
  - "Марафонец" - наблюдения 7 дней подряд
  - "Ранняя пташка" - 10 записей до 6:00
  - "Ночной охотник" - 10 записей ночных видов

- **FR-040:** Статистика по регионам:
  - Рейтинг наблюдателей в регионе
  - Топ-виды региона
  - Редкие находки

- **FR-041:** Личная статистика:
  - Всего видов обнаружено
  - География наблюдений
  - Временная активность
  - Качество записей

- **FR-042:** Уведомления о достижениях:
  - "Поздравляем! Получен бейдж: [Название]"
  - Прогресс до следующего достижения

**Примечание:** Вся аналитика на сервере, приложение отображает результаты

##### Справочник птиц (базовый)
- **FR-043:** Каталог европейских видов птиц
- **FR-044:** Карточка вида с описанием и фото
- **FR-045:** Примеры голосов (аудио из датасета)
- **FR-046:** Поиск по названию вида
- **FR-047:** Интеграция с результатами: кнопка "Подробнее о виде"

---

#### 4.2.2 Релиз 3: Интеграции и аналитика (3-4 месяца после R2)

##### Интеграция с eBird
- **FR-048:** Подключение аккаунта eBird
- **FR-049:** Автоматическая отправка наблюдений в eBird (опционально)
- **FR-050:** Синхронизация checklists из eBird
- **FR-051:** Импорт личной статистики из eBird

##### Интеграция с iNaturalist
- **FR-052:** Подключение аккаунта iNaturalist
- **FR-053:** Автоматическая отправка наблюдений с фото/аудио
- **FR-054:** Получение подтверждений сообщества
- **FR-055:** Синхронизация данных

**Примечание:** Все интеграции на стороне сервера через API

##### Интеграция с погодными данными
- **FR-056:** Автоматический сбор погоды при каждом наблюдении:
  - Температура, осадки, ветер, давление
- **FR-057:** Корреляционный анализ (на сервере):
  - "Вид X более активен при температуре 10-15°C"
  - "Лучшее время для наблюдения за видом Y"
- **FR-058:** Предсказания активности:
  - "Завтра идеальные условия для наблюдения"
- **FR-059:** Отображение погоды в истории наблюдений

##### Расширенная аналитика
- **FR-060:** Карта наблюдений с кластеризацией
- **FR-061:** Экспорт данных в CSV/Excel/GeoJSON
- **FR-062:** Графики активности по времени/датам
- **FR-063:** Сравнение с другими наблюдателями

---

#### 4.2.3 Релиз 4+: Инновации (долгосрочно, 6+ месяцев)

##### Акустические "отпечатки пальцев" особей
**ОЧЕНЬ ИННОВАЦИОННО - R&D проект**

- **FR-064:** ML модель для извлечения уникальных характеристик голоса (на сервере)
- **FR-065:** База данных "отпечатков" индивидуальных особей
- **FR-066:** Алгоритм сопоставления: "Это та же птица?"
- **FR-067:** Отслеживание перемещений конкретных особей
- **FR-068:** Карта территориальных зон особей
- **FR-069:** Популяционный анализ (количество уникальных особей)
- **FR-070:** Уведомления: "Вы встретили ту же синицу, что неделю назад!"

**Применение:**
- Научные исследования миграций
- Изучение территориального поведения
- Точная оценка численности популяций
- Изучение вокальной пластичности

**Технология:**
- Voiceprint ML (аналог face recognition для голосов)
- Требует большой датасет → критична монополия на данные!
- Возможно партнерство с университетом/научной организацией

##### Режим подманивания (Future)
- **FR-071:** Выбор вида птицы для подманивания
- **FR-072:** Воспроизведение позывков из справочника
- **FR-073:** Автоматическое прослушивание откликов
- **FR-074:** Запись откликнувшихся птиц
- **FR-075:** Анализ эффективности подманивания

##### Многоязычность
- **FR-076:** Добавление европейских языков:
  - Немецкий, Французский, Испанский, Польский и др.
- **FR-077:** Локализация названий видов птиц
- **FR-078:** Мультиязычные описания в справочнике

---

## 5. Технические требования

### 5.1 Платформа
- **TR-001:** Мобильное приложение для Android
- **TR-002:** Минимальная версия Android: 11.0 (API level 30)
- **TR-003:** Целевая версия: Android 14 (API level 34)

### 5.2 Технологический стек

#### 5.2.1 Frontend (Mobile)
- **Язык:** Kotlin
- **UI Framework:** Jetpack Compose
- **Архитектура:** MVVM + Clean Architecture
- **DI:** Hilt
- **Navigation:** Jetpack Navigation Compose

#### 5.2.2 Локальное хранилище
- **База данных:** Room (SQLite)
- **Preferences:** DataStore
- **Файловое хранилище:** Internal Storage для аудио

#### 5.2.3 Машинное обучение
- **ML Framework:** TensorFlow Lite for Android
- **Модель:** Готовая открытая модель для распознавания птиц (например, BirdNET)
- **Обработка аудио:** AudioRecord API
- **Формат модели:** .tflite

#### 5.2.4 Backend (КРИТИЧЕСКИЙ КОМПОНЕНТ - Data-First подход)

**ВАЖНО:** Backend - это ядро системы. Вся бизнес-логика, аналитика и монетизация здесь.

##### Архитектура backend:

```
┌─────────────────────────────────────────────────┐
│            API Layer (REST/GraphQL)              │
│  - Регистрация/Авторизация                      │
│  - Загрузка наблюдений                          │
│  - Получение статистики                         │
│  - Управление экспедициями                      │
└───────────────────┬─────────────────────────────┘
                    │
┌───────────────────▼─────────────────────────────┐
│         Business Logic Layer                     │
│  - Обработка данных                             │
│  - Геймификация (бейджи, ачивки)               │
│  - Аналитика и статистика                       │
│  - Интеграции (eBird, погода)                   │
└───────────────────┬─────────────────────────────┘
                    │
┌───────────────────▼─────────────────────────────┐
│              Data Layer                          │
│  - PostgreSQL (метаданные, пользователи)        │
│  - S3/MinIO (аудиофайлы)                        │
│  - Redis (кэш, реал-тайм сессии)               │
│  - ElasticSearch (полнотекстовый поиск)         │
└───────────────────┬─────────────────────────────┘
                    │
┌───────────────────▼─────────────────────────────┐
│             ML Pipeline Layer                    │
│  - Повторное распознавание (точная модель)      │
│  - Оценка качества записи                       │
│  - Дообучение моделей                           │
│  - Анализ паттернов (в будущем)                 │
└─────────────────────────────────────────────────┘
```

##### Технологический стек Backend (Рекомендация для solo-dev):

**Язык и Framework:**
- **Python 3.11+** с **FastAPI** (рекомендовано)
  - ✅ Быстрая разработка
  - ✅ Отличная интеграция с ML (TensorFlow, PyTorch)
  - ✅ Async/await для высокой производительности
  - ✅ Автоматическая документация API (OpenAPI/Swagger)
  - ✅ Много библиотек для data science

**Альтернатива:** Kotlin + Spring Boot (если хотите один язык для всего)

**API:**
- RESTful API (основное)
- WebSocket для реал-тайм (экспедиции)
- GraphQL (опционально для сложных запросов)

**Аутентификация:**
- JWT tokens (access + refresh)
- OAuth2 для интеграций (eBird, iNaturalist)
- Опциональная регистрация (анонимные пользователи)

**Базы данных:**
- **PostgreSQL** - главная БД
  - Пользователи
  - Наблюдения (метаданные)
  - Виды птиц
  - Экспедиции
  - Достижения
- **Redis** - кэш и реал-тайм
  - Сессии пользователей
  - Реал-тайм данные экспедиций
  - Rate limiting
- **ElasticSearch** - поиск (опционально для MVP)
  - Полнотекстовый поиск по видам
  - Геопространственный поиск

**Хранилище файлов:**
- **S3 (AWS)** или **MinIO** (self-hosted S3-compatible)
  - Аудиофайлы (MP3)
  - Изображения птиц (справочник)
  - Экспортированные датасеты

**ML Pipeline:**
- **TensorFlow Serving** или **ONNX Runtime**
  - Повторное распознавание с точной моделью
- **Celery** + **RabbitMQ** (или Redis)
  - Асинхронная обработка аудио
  - Фоновые задачи (дообучение, статистика)
- **MLflow** (опционально)
  - Версионирование моделей
  - Эксперименты

**Мониторинг и логи:**
- **Grafana** + **Prometheus** - метрики
- **Sentry** - error tracking
- **ELK Stack** (опционально) - логи

##### Ключевые API endpoints (MVP):

**Authentication:**
- `POST /api/v1/auth/register` - Регистрация
- `POST /api/v1/auth/login` - Вход
- `POST /api/v1/auth/refresh` - Обновление токена
- `GET /api/v1/auth/me` - Профиль пользователя

**Observations (Наблюдения):**
- `POST /api/v1/observations` - Загрузка наблюдения
  - Body: JSON метаданные + аудио файл (multipart)
  - Response: ID наблюдения, статус обработки
- `GET /api/v1/observations` - Список наблюдений пользователя
  - Query params: filters (вид, дата, локация), pagination
- `GET /api/v1/observations/{id}` - Детали наблюдения
- `DELETE /api/v1/observations/{id}` - Удаление наблюдения

**Species (Виды):**
- `GET /api/v1/species` - Список всех видов
- `GET /api/v1/species/{id}` - Детали вида
- `GET /api/v1/species/search?q={query}` - Поиск вида

**Sync:**
- `POST /api/v1/sync/batch` - Пакетная загрузка наблюдений
- `GET /api/v1/sync/status` - Статус синхронизации

##### Ключевые API endpoints (Post-MVP):

**Expeditions (Релиз 2):**
- `POST /api/v1/expeditions` - Создать экспедицию
- `POST /api/v1/expeditions/{code}/join` - Присоединиться
- `GET /api/v1/expeditions/{id}` - Детали экспедиции
- `WS /ws/expeditions/{id}` - WebSocket для реал-тайм

**Gamification (Релиз 2):**
- `GET /api/v1/achievements` - Мои достижения
- `GET /api/v1/statistics/me` - Моя статистика
- `GET /api/v1/leaderboard?region={region}` - Рейтинг

**Integrations (Релиз 3):**
- `POST /api/v1/integrations/ebird/connect` - Подключить eBird
- `POST /api/v1/integrations/ebird/sync` - Синхронизация
- `POST /api/v1/integrations/inaturalist/connect` - Подключить iNaturalist

**Analytics (Релиз 3):**
- `GET /api/v1/analytics/regional` - Статистика по региону
- `GET /api/v1/analytics/weather-correlation` - Корреляция с погодой
- `POST /api/v1/export` - Экспорт данных

##### Обработка загруженного наблюдения (Pipeline):

1. **Мобильное приложение** → `POST /api/v1/observations`
   - JSON: {species_id, lat, lng, timestamp, confidence}
   - File: audio.mp3

2. **API** → Сохранение в БД (статус: "processing")
   - Метаданные → PostgreSQL
   - Аудио → S3
   - Задача в очередь → Celery

3. **Background Worker (Celery)**:
   - Загрузка аудио из S3
   - Повторное распознавание (точная ML модель)
   - Оценка качества записи (шум, длительность)
   - Если результат отличается от мобильного:
     - Обновление species_id
     - Уведомление пользователю (опционально)
   - Обновление статуса: "completed"

4. **Дополнительная обработка** (async):
   - Проверка достижений (новые бейджи?)
   - Обновление статистики региона
   - Интеграции (отправка в eBird если настроено)

##### Масштабирование backend:

**MVP (до 1,000 пользователей):**
- 1 сервер (VPS: 4 CPU, 8GB RAM)
- PostgreSQL на том же сервере
- Redis на том же сервере
- S3 (AWS или MinIO)
- Celery worker на том же сервере

**Релиз 2 (до 10,000 пользователей):**
- Load Balancer (Nginx)
- 2-3 API сервера
- Managed PostgreSQL (AWS RDS / DigitalOcean)
- Managed Redis
- Несколько Celery workers
- CDN для статики

**Релиз 3+ (100,000+ пользователей):**
- Kubernetes кластер
- Horizontal Pod Autoscaling
- Microservices (при необходимости)
- Distributed ML inference
- Data warehouse (BigQuery / Snowflake)

##### Хостинг (Рекомендации):

**Опция 1: AWS** (дорого, но масштабируемо)
- EC2 / ECS для API
- RDS для PostgreSQL
- S3 для аудио
- Lambda для background tasks

**Опция 2: DigitalOcean** (оптимально для MVP)
- Droplet для API
- Managed PostgreSQL
- Spaces (S3-compatible)
- Хорошее соотношение цена/качество

**Опция 3: Hetzner** (дешево, хорошо для Европы)
- Cloud Server
- PostgreSQL на сервере
- MinIO для S3
- Низкие цены, серверы в Европе

**Опция 4: Railway / Render** (для прототипа)
- Быстрый деплой
- PostgreSQL included
- Дорого на масштабе

##### Безопасность backend:

- HTTPS only (Let's Encrypt)
- Rate limiting (защита от абьюза)
- Input validation (защита от инъекций)
- CORS правильно настроен
- JWT с коротким TTL (access token: 15 мин, refresh: 7 дней)
- Шифрование паролей (bcrypt/argon2)
- Регулярные бэкапы БД
- Secrets management (environment variables, не в коде!)

##### Оценка стоимости (MVP, 1,000 активных пользователей):

**DigitalOcean:**
- Droplet (4 CPU, 8GB): $48/месяц
- Managed PostgreSQL: $15/месяц
- Spaces (100GB): $5/месяц
- **Итого: ~$70/месяц**

**Трафик:**
- Загрузка аудио: 1 запись = 1MB (MP3)
- 1,000 пользователей × 10 записей/месяц = 10,000 MB = 10GB
- Spaces включает 250GB трафика → достаточно

**Масштаб (10,000 пользователей):**
- ~$200-300/месяц
- Покрывается premium подписками (~300 пользователей по $5/мес)

#### 5.2.5 Дополнительные библиотеки
- **Геолокация:** Google Location Services
- **Аудио:** Android MediaRecorder, ExoPlayer
- **Сеть:** Retrofit, OkHttp
- **Изображения:** Coil
- **Многопоточность:** Kotlin Coroutines, Flow

### 5.3 Требования к производительности
- **TR-004:** Время распознавания птицы: не более 3 секунд
- **TR-005:** Размер установленного приложения: не более 150 MB (включая ML-модель)
- **TR-006:** Потребление RAM: не более 200 MB в активном режиме
- **TR-007:** Потребление батареи в режиме аудио-ловушки: не более 5% в час

### 5.4 Требования к качеству распознавания
- **TR-008:** Целевая точность распознавания: 80-90%
- **TR-009:** Поддержка распознавания в условиях фонового шума
- **TR-010:** Минимальная длительность аудио для распознавания: 3 секунды
- **TR-011:** Максимальная длительность записи: 60 секунд

### 5.5 Требования к аудио
- **TR-012:** Формат хранения: MP3 (128 kbps)
- **TR-013:** Частота дискретизации: 44.1 kHz
- **TR-014:** Каналы: Моно

### 5.6 Офлайн режим
- **TR-015:** Все функции распознавания работают без интернета
- **TR-016:** Справочник птиц доступен офлайн (предзагруженные данные)
- **TR-017:** Автоматическая синхронизация при появлении интернета

---

## 6. Требования к интерфейсу (UI/UX)

### 6.1 Дизайн система
- **UI-001:** Следование Material Design 3 Guidelines
- **UI-002:** Поддержка светлой и темной темы
- **UI-003:** Адаптация под разные размеры экранов (от 5" до планшетов)

### 6.2 Основные экраны

#### 6.2.1 Главный экран (Home)
- Кнопка начала записи (большая, центральная)
- Переключатель режимов работы (Обычный / Непрерывный / Аудио-ловушка)
- Индикатор состояния (запись / анализ / готово)
- Последние наблюдения (3-5 записей)

#### 6.2.2 Экран результата
- Название определенного вида (крупно)
- Процент уверенности
- Кнопка прослушивания записи
- Информация: время, локация
- Кнопка "Подробнее" (переход в справочник)

#### 6.2.3 История наблюдений
- Список всех наблюдений (карточки)
- Фильтры: по виду, дате, локации
- Поиск по названию
- Экспорт данных

#### 6.2.4 Настройки
- Переключатель языка
- Настройки разрешений (микрофон, геолокация)
- Настройки синхронизации
- Управление аккаунтом (если авторизован)
- Настройки режима аудио-ловушки (длительность, чувствительность)

#### 6.2.5 Справочник птиц (Post-MVP)
- Список видов с фото
- Поиск и фильтрация
- Карточка вида с подробной информацией

### 6.3 Требования к UX
- **UI-004:** Время отклика интерфейса: < 100ms
- **UI-005:** Интуитивная навигация без обучения
- **UI-006:** Доступность (Accessibility) - поддержка TalkBack
- **UI-007:** Понятные индикаторы состояния процессов

### 6.4 Локализация
- **UI-008:** Русский язык (первый релиз)
- **UI-009:** Английский язык (первый релиз)
- **UI-010:** Архитектура для добавления новых языков

---

## 7. Нефункциональные требования

### 7.1 Безопасность
- **NFR-001:** Шифрование данных пользователя при синхронизации (HTTPS/TLS)
- **NFR-002:** Безопасное хранение токенов аутентификации
- **NFR-003:** Запрос разрешений только при необходимости
- **NFR-004:** Соответствие GDPR для обработки персональных данных

### 7.2 Надежность
- **NFR-005:** Обработка ошибок без крашей приложения
- **NFR-006:** Автоматическое восстановление после сбоев
- **NFR-007:** Резервное копирование данных при синхронизации
- **NFR-008:** Graceful degradation при отсутствии интернета

### 7.3 Масштабируемость
- **NFR-009:** База данных должна поддерживать до 10,000 записей на устройстве
- **NFR-010:** Архитектура должна позволять добавление новых видов птиц
- **NFR-011:** Возможность обновления ML-модели без переустановки приложения

### 7.4 Поддерживаемость
- **NFR-012:** Код должен соответствовать Kotlin Coding Conventions
- **NFR-013:** Покрытие тестами: минимум 60% для бизнес-логики
- **NFR-014:** Документация API и архитектуры
- **NFR-015:** Логирование критических операций

### 7.5 Совместимость
- **NFR-016:** Поддержка устройств с разрешением от 720p
- **NFR-017:** Работа на устройствах с минимум 3GB RAM
- **NFR-018:** Поддержка различных производителей (Samsung, Xiaomi, Pixel, etc.)

---

## 8. Архитектура приложения

### 8.1 Структура приложения

```
app/
├── data/               # Слой данных
│   ├── local/         # Локальное хранилище (Room, DataStore)
│   ├── remote/        # API клиенты (Retrofit)
│   ├── model/         # Data models
│   └── repository/    # Репозитории
├── domain/            # Бизнес-логика
│   ├── model/        # Domain models
│   ├── usecase/      # Use cases
│   └── repository/   # Repository interfaces
├── presentation/      # UI слой
│   ├── home/         # Главный экран
│   ├── result/       # Результаты распознавания
│   ├── history/      # История наблюдений
│   ├── settings/     # Настройки
│   └── common/       # Общие UI компоненты
├── ml/               # Машинное обучение
│   ├── model/        # TFLite модели
│   ├── processor/    # Обработка аудио
│   └── classifier/   # Классификатор
└── service/          # Background services
    ├── recording/    # Сервис записи
    ├── recognition/  # Сервис распознавания
    └── sync/         # Сервис синхронизации
```

### 8.2 Основные компоненты

#### 8.2.1 Audio Recording Service
- Фоновая запись аудио
- Управление жизненным циклом записи
- Уведомления о состоянии записи

#### 8.2.2 ML Recognition Engine
- Загрузка TFLite модели
- Предобработка аудио
- Распознавание вида птицы
- Post-processing результатов

#### 8.2.3 Data Sync Manager
- Отслеживание состояния сети
- Синхронизация новых записей
- Conflict resolution
- Retry mechanism

#### 8.2.4 Location Manager
- Получение GPS координат
- Кэширование последней локации
- Обработка разрешений

---

## 9. План разработки

### 9.1 Этапы разработки MVP

#### Фаза 1: Подготовка и прототипирование (2-3 недели)
- Настройка проекта и CI/CD
- Выбор и интеграция ML-модели
- Прототип UI (Figma или сразу в Compose)
- Настройка базы данных и архитектуры

#### Фаза 2: Основной функционал (4-5 недель)
- Запись аудио с микрофона
- Интеграция ML-модели и распознавание
- Сохранение результатов в локальную БД
- Базовый UI для записи и отображения результатов

#### Фаза 3: Режимы работы (3-4 недели)
- Режим непрерывного определения
- Режим аудио-ловушки с таймером
- Фоновые сервисы и уведомления
- Оптимизация энергопотребления

#### Фаза 4: Синхронизация и авторизация (2-3 недели)
- Backend API (можно использовать Firebase для ускорения)
- Опциональная авторизация
- Синхронизация данных с облаком
- Офлайн-режим с последующей синхронизацией

#### Фаза 5: История и дополнительный UI (2 недели)
- Экран истории наблюдений
- Фильтрация и поиск
- Настройки приложения
- Локализация (RU/EN)

#### Фаза 6: Тестирование и оптимизация (2-3 недели)
- Unit и Integration тесты
- UI тесты
- Тестирование на реальных устройствах
- Оптимизация производительности
- Исправление багов

**Итого MVP: 15-20 недель (4-5 месяцев)**

### 9.2 Post-MVP функционал

#### Релиз 2: Справочник птиц (3-4 недели)
- База данных видов птиц
- Карточки видов с информацией
- Интеграция с результатами распознавания

#### Релиз 3: Расширенная аналитика (2-3 недели)
- Карта наблюдений
- Статистика и графики
- Экспорт данных

#### Релиз 4: Режим подманивания (3-4 недели)
- Воспроизведение позывков
- Автоматическое прослушивание откликов
- Специализированный UI для этого режима

---

## 10. Риски и ограничения

### 10.1 Технические риски

**Риск 1: Низкая точность распознавания**
- **Вероятность:** Средняя
- **Влияние:** Высокое
- **Митигация:**
  - Тщательный выбор готовой ML-модели (BirdNET, Bird-CLEF winners)
  - Тестирование на реальных данных
  - Возможность дообучения модели в будущем

**Риск 2: Высокое энергопотребление**
- **Вероятность:** Высокая
- **Влияние:** Высокое
- **Митигация:**
  - Оптимизация частоты распознавания
  - Использование Battery Optimization API
  - Настройки чувствительности в режиме ловушки

**Риск 3: Проблемы с производительностью ML на устройстве**
- **Вероятность:** Средняя
- **Влияние:** Среднее
- **Митигация:**
  - Использование оптимизированных TFLite моделей
  - GPU Delegation для ускорения
  - Тестирование на устройствах с разной производительностью

**Риск 4: Ограничения Android для фоновой работы**
- **Вероятность:** Высокая
- **Влияние:** Высокое
- **Митигация:**
  - Использование Foreground Service с уведомлениями
  - Правильная обработка Doze mode
  - Запрос пользователя отключить оптимизацию батареи для приложения

### 10.2 Организационные риски

**Риск 5: Сложность solo-разработки**
- **Вероятность:** Высокая
- **Влияние:** Среднее
- **Митигация:**
  - Четкое планирование этапов
  - Использование готовых решений где возможно (Firebase, готовые ML-модели)
  - Приоритизация функционала (MVP first)

**Риск 6: Превышение сроков разработки**
- **Вероятность:** Средняя
- **Влияние:** Среднее
- **Митигация:**
  - Гибкий подход к MVP (можно урезать функции)
  - Регулярный пересмотр приоритетов
  - Использование готовых библиотек и решений

### 10.3 Ограничения

**Ограничение 1:** Качество распознавания зависит от качества готовой ML-модели
**Ограничение 2:** Для режима аудио-ловушки нужна поддержка от производителя (некоторые устройства агрессивно убивают фоновые процессы)
**Ограничение 3:** Размер приложения будет > 100 MB из-за ML-модели
**Ограничение 4:** Первая версия поддерживает только Android (нет iOS)

---

## 11. Критерии приемки MVP

### 11.1 Функциональные критерии
- ✅ Пользователь может записать пение птицы и получить результат распознавания
- ✅ Работает режим непрерывного определения с фоновой записью
- ✅ Работает режим аудио-ловушки с настройкой времени
- ✅ Все записи сохраняются с геолокацией, временем и аудио
- ✅ История наблюдений доступна с фильтрацией и поиском
- ✅ Приложение работает без интернета (кроме синхронизации)
- ✅ Данные синхронизируются с облаком при авторизации
- ✅ Поддерживается русский и английский языки

### 11.2 Технические критерии
- ✅ Точность распознавания: 80-90%
- ✅ Время распознавания: < 3 секунд
- ✅ Приложение не крашится при типовых сценариях
- ✅ Корректная работа на Android 11+
- ✅ Размер APK: < 150 MB

### 11.3 UX критерии
- ✅ Интуитивно понятный интерфейс
- ✅ Соответствие Material Design 3
- ✅ Плавные анимации и переходы
- ✅ Понятные индикаторы состояния

---

## 12. Дополнительные материалы

### 12.1 Полезные ресурсы

**ML Models:**
- BirdNET: https://github.com/kahst/BirdNET-Analyzer
- Bird-CLEF: https://www.kaggle.com/competitions/birdclef-2024

**Датасеты:**
- Xeno-canto: https://xeno-canto.org/ (крупнейшая база записей птиц)
- Macaulay Library: https://www.macaulaylibrary.org/

**Android ML:**
- TensorFlow Lite: https://www.tensorflow.org/lite/android
- ML Kit: https://developers.google.com/ml-kit

**Backend (опции):**
- Firebase: https://firebase.google.com/
- Supabase: https://supabase.com/ (open-source alternative)

### 12.2 Аналоги для анализа
- **Merlin Bird ID** (Cornell Lab) - лидер рынка
- **BirdNET** - open-source решение
- **ChirpOMatic** - focus на голосовом распознавании
- **Song Sleuth** - похожий функционал

---

## Приложение A: Глоссарий

- **MVP** - Minimum Viable Product, минимально жизнеспособный продукт
- **ML** - Machine Learning, машинное обучение
- **TFLite** - TensorFlow Lite, облегченная версия TensorFlow для мобильных устройств
- **API** - Application Programming Interface
- **GPS** - Global Positioning System
- **MVVM** - Model-View-ViewModel, архитектурный паттерн
- **SQLite** - Встроенная реляционная база данных
- **Room** - Библиотека для работы с SQLite на Android

---

**Документ подготовлен:** 2026-02-17
**Согласовано:** Владелец проекта
**Статус:** Готов к разработке
